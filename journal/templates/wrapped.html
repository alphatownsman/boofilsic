{% load static %}
{% load i18n %}
{% load l10n %}
{% load humanize %}
{% load admin_url %}
{% load mastodon %}
{% load oauth_token %}
{% load truncate %}
{% load thumb %}
{% load collection %}
{% load user_actions %}
<!DOCTYPE html>
<html lang="zh" class="classic-page">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ site_name }} - {{ identity.display_name }} - {{ year }} 年度小结</title>
    {% include "common_libs.html" %}
    <script src="https://unpkg.com/rough-viz@2.0.5"></script>
  </head>
  <body>
    {% include "_header.html" %}
    <main>
      <div class="grid__main">
        <h5>{{ identity.display_name }} 的 {{ year }} 小结</h5>
        <div id="viz0" style="width: 20em; height: 12em;"></div>
        <div id="viz1" style="width: 12em; height: 12em;"></div>
        {{ by_cat|json_script:"cat-data" }}
        {{ monthly|json_script:"mon-data" }}
        <script>
          var cats = JSON.parse(document.getElementById('cat-data').textContent);
          var mons = JSON.parse(document.getElementById('mon-data').textContent);
          new roughViz.Bar({
            element: '#viz0', // container selection
            data: {
              labels: ['一', '二', '三', '四', '五', '六', '七', '八', '九', '十', '十一', '十二'],
              values: mons
            },
            roughness:1,
            simplification:1,
            fillStyle: 'cross-hatch',
            color: 'skyblue',
            axisFontSize: '0rem',
          });
          var data = {labels: [], values: []};
          for (var key in cats) {
            data.labels.push(key);
            data.values.push(cats[key]);
          }
          new roughViz.Donut({
            element: '#viz1', // container selection
            data: data,
            roughness:3,
            simplification:1,
            legend: false,
          });

        </script>
        <canvas id="c" style="width:20rem;height:20rem;"></canvas>
        <script>
          var canvas = document.getElementById('c');
          var ctx = canvas.getContext('2d');
          var img = document.getElementById('viz0').getElementsByTagName('svg')[0]
          document.body.onload = function() {
            ctx.drawImage(img, 0, 0, 200, 200);
          }
        </script>
      </div>
      {% include "_sidebar.html" with show_profile=1 %}
    </main>
    {% include "_footer.html" %}
  </body>
</html>

{% load static %}
{% load i18n %}
{% load l10n %}
{% load admin_url %}
{% load mastodon %}
{% load oauth_token %}
{% load truncate %}
{% load duration %}
{% load user_actions %}

{% for comment in comments %}
{% if forloop.counter <= 10 %}
<div>
<div>
<a href="{% url 'journal:user_profile' comment.owner.mastodon_username %}">{{ comment.owner.username }}</a>
<span class="muted" style="font-size: 75%;">

{% if comment.visibility > 0 %}
<i class="fa-solid fa-lock"></i>
{% endif %}

{% if comment.metadata.shared_link %}
<a href="{{ comment.metadata.shared_link }}" target="_blank" rel="noopener">{{ comment.created_time|date }}</a>
{% else %}
{{ comment.created_time|date }}
{% endif %}

</span>
</div>
{% if comment.rating_grade %}
{{ comment.rating_grade|rating_star }}
{% endif %}

{% if comment.focus_item %}
<a href="{{ comment.focus_item.url }}">{{ comment.focus_item.title }}</a>
{% endif %}

{{ comment.html|safe }}

<span class="action-bar inline">
  <span>
    {% liked_piece comment as liked %}
    {% include 'like_stats.html' with liked=liked piece=comment %}
  </span>
</span>
</div>
{% else %}
<a hx-get="{% url 'catalog:comments' comment.item.url_path comment.item.uuid %}?last={{ comment.created_time|date:'Y-m-d H:i:s.uO'|urlencode }}" hx-trigger="click" hx-swap="outerHTML"><button class="outline">显示更多</button></a>
{% endif %}
{% empty %}
<div class="empty">
{% trans '暂无' %}
</div>
{% endfor %}
